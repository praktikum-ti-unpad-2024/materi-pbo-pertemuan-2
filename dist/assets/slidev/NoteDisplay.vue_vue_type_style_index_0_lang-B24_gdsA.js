import{d as S,z as A,r as x,K as H,L as D,E as B,f as u,n as d,g as L,t as M,o as k,p as N}from"../modules/vue-a-ZG5QjA.js";import{C as $}from"../index-B7NdEJpk.js";const I=["innerHTML"],P=["textContent"],T=["textContent"],h="slidev-note-fade",a="slidev-note-click-mark",R=S({__name:"NoteDisplay",props:{class:{},noteHtml:{},note:{},highlight:{type:Boolean,default:!0},placeholder:{},clicksContext:{},autoScroll:{type:Boolean}},emits:["markerDblclick","markerClick"],setup(b,{emit:E}){const n=b,g=E,v=A(()=>n.clicksContext!=null&&n.noteHtml?.includes(a)),r=x(null);function C(){if(!r.value||!v.value)return;const i=Array.from(r.value.querySelectorAll(`.${a}`)),m=new Map,c=new Map;let _=0;for(const s of i){const o=Number(s.dataset.clicks);m.set(s,o);let t=s,e=s.parentElement;for(;e&&t!==r.value;)c.has(e)||c.set(e,[[null,_]]),c.get(e).push([t,o]),t=e,e=e.parentElement;_=o}const w=new Map;for(const[s,o]of c){let t=!1,e=0;for(const l of Array.from(s.childNodes)){let p=!1;for(;l===o[e+1]?.[0];)p=!0,e++;if(p)continue;let f=l;if(l.nodeType===3){if(!l.textContent?.trim())continue;f=document.createElement("span"),f.textContent=l.textContent,s.insertBefore(f,l),l.remove()}t||=e===0,w.set(f,o[e][1])}t||(o[0][1]=-1)}return s=>{const o=n.highlight;for(const[t,e]of c)t.classList.toggle(h,o&&!e.some(([l,p])=>p===s));for(const[t,e]of w)t.classList.toggle(h,o&&e!==s);for(const[t,e]of m)t.classList.remove(h),t.classList.toggle(`${a}-past`,o&&e<s),t.classList.toggle(`${a}-active`,o&&e===s),t.classList.toggle(`${a}-next`,o&&e===s+1),t.classList.toggle(`${a}-future`,o&&e>s+1),t.ondblclick=l=>{o&&(g("markerDblclick",l,e),!l.defaultPrevented&&(n.clicksContext.current=e,l.stopPropagation(),l.stopImmediatePropagation()))},t.onclick=l=>{o&&g("markerClick",l,e)},o&&n.autoScroll&&e===s&&t.scrollIntoView({block:"center",behavior:"smooth"})}}const y=x();return H(()=>[n.noteHtml,n.highlight],()=>{N(()=>{y.value=C()})},{immediate:!0}),D(()=>{C()}),B(()=>{const i=n.clicksContext?.current??$;y.value?.(i)}),(i,m)=>i.noteHtml?(k(),u("div",{key:0,ref_key:"noteDisplay",ref:r,class:d(["prose overflow-auto outline-none slidev-note",[n.class,v.value?"slidev-note-with-clicks":""]]),innerHTML:i.noteHtml},null,10,I)):i.note?(k(),u("div",{key:1,class:d(["prose overflow-auto outline-none slidev-note",n.class])},[L("p",{textContent:M(i.note)},null,8,P)],2)):(k(),u("div",{key:2,class:d(["prose overflow-auto outline-none opacity-50 italic select-none slidev-note",n.class])},[L("p",{textContent:M(n.placeholder||"No notes.")},null,8,T)],2))}});export{R as _};
